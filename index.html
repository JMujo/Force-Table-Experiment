<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Force Table Simulator (Student Mode)</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #0b0f17; color: #e9eef7; }
    .wrap { display: grid; grid-template-columns: 360px 1fr; gap: 14px; padding: 14px; }
    .panel { background: #111827; border: 1px solid #22304a; border-radius: 14px; padding: 14px; }
    h1 { font-size: 18px; margin: 0 0 10px; }
    h2 { font-size: 14px; margin: 14px 0 8px; color: #cbd5e1; }
    .row { display: grid; grid-template-columns: 1fr 110px; gap: 10px; align-items: center; margin: 8px 0; }
    .row label { font-size: 12px; color: #cbd5e1; }
    input[type="number"] { width: 100%; padding: 8px; border-radius: 10px; border: 1px solid #2a3a58; background: #0b1220; color: #e9eef7; }
    select, button { width: 100%; padding: 10px; border-radius: 12px; border: 1px solid #2a3a58; background: #0b1220; color: #e9eef7; }
    button { cursor: pointer; }
    button:hover { border-color: #3b82f6; }
    .small { font-size: 12px; color: #cbd5e1; line-height: 1.35; }
    .pill { display: inline-block; padding: 4px 8px; border-radius: 999px; border: 1px solid #2a3a58; background: #0b1220; font-size: 12px; }
    .status { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    canvas { width: 100%; height: calc(100vh - 28px); background: #0b1220; border-radius: 14px; border: 1px solid #22304a; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .divider { height: 1px; background: #22304a; margin: 12px 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h1>Force Table Simulator</h1>
      <div class="small">
        Student mode: choose up to <b>3 pulleys</b>, adjust <b>angles</b> and <b>masses</b>, and try to reach
        <span class="pill">equilibrium</span>.
      </div>

      <div class="divider"></div>

      <div class="row">
        <label for="nPulleys">Number of pulleys</label>
        <select id="nPulleys">
          <option value="1">1 pulley</option>
          <option value="2" selected>2 pulleys</option>
          <option value="3">3 pulleys</option>
        </select>
      </div>

      <div class="divider"></div>

      <h2>Pulley 1</h2>
      <div class="row">
        <label>Angle θ₁ (deg)</label>
        <input id="a1" type="number" min="0" max="360" step="0.1" value="0">
      </div>
      <div class="row">
        <label>Mass m₁ (g)</label>
        <input id="m1" type="number" min="0" step="1" value="100">
      </div>

      <h2>Pulley 2</h2>
      <div class="row">
        <label>Angle θ₂ (deg)</label>
        <input id="a2" type="number" min="0" max="360" step="0.1" value="120">
      </div>
      <div class="row">
        <label>Mass m₂ (g)</label>
        <input id="m2" type="number" min="0" step="1" value="200">
      </div>

      <div id="p3Block">
        <h2>Pulley 3</h2>
        <div class="row">
          <label>Angle θ₃ (deg)</label>
          <input id="a3" type="number" min="0" max="360" step="0.1" value="240">
        </div>
        <div class="row">
          <label>Mass m₃ (g)</label>
          <input id="m3" type="number" min="0" step="1" value="100">
        </div>
      </div>

      <div class="divider"></div>

      <div class="status">
        <span class="pill" id="eqBadge">—</span>
        <span class="pill" id="attemptPill">Attempts: 0</span>
        <span class="pill">Tolerance: <span id="tolTxt">0.05 N</span></span>
      </div>

      <div class="row" style="margin-top:10px;">
        <label>Equilibrium tolerance (N)</label>
        <input id="tol" type="number" min="0.001" step="0.001" value="0.05">
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <button id="randomize">Randomize angles</button>
        <button id="reset">Reset</button>
      </div>

      <div class="divider"></div>

      <div class="small">
        Keep adjusting until it says <b>Balanced</b>.
      </div>
    </div>

    <canvas id="cv"></canvas>
  </div>

<script>
(() => {
  const g = 9.81; // internal only
  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');

  const el = (id) => document.getElementById(id);
  const nPulleys = el('nPulleys');
  const p3Block = el('p3Block');

  const a1 = el('a1'), a2 = el('a2'), a3 = el('a3');
  const m1 = el('m1'), m2 = el('m2'), m3 = el('m3');
  const tol = el('tol'), tolTxt = el('tolTxt');
  const eqBadge = el('eqBadge');

  const randomizeBtn = el('randomize');
  const resetBtn = el('reset');

  const attemptPill = el('attemptPill');
  let attempts = 0;
  function setAttempts(x) {
    attempts = Math.max(0, Math.floor(x));
    attemptPill.textContent = `Attempts: ${attempts}`;
  }
  function bumpAttempt() { setAttempts(attempts + 1); }

  function resize() {
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    const rect = cv.getBoundingClientRect();
    cv.width = Math.floor(rect.width * dpr);
    cv.height = Math.floor(rect.height * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener('resize', resize);
  resize();

  function deg2rad(d) { return d * Math.PI / 180; }
  function clampAngle(d) {
    let x = d % 360;
    if (x < 0) x += 360;
    return x;
  }

  function forceFromMassAngle(m_g, ang_deg) {
    const m_kg = Math.max(0, m_g) / 1000;
    const T = m_kg * g;            // Newtons
    const th = deg2rad(ang_deg);
    return { T, Fx: T*Math.cos(th), Fy: T*Math.sin(th) };
  }

  function vecMag(x,y){ return Math.hypot(x,y); }

  function drawArrow(x0,y0, x1,y1, label) {
    ctx.save();
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(x0,y0);
    ctx.lineTo(x1,y1);
    ctx.stroke();

    const ang = Math.atan2(y1-y0, x1-x0);
    const head = 10;
    ctx.beginPath();
    ctx.moveTo(x1,y1);
    ctx.lineTo(x1 - head*Math.cos(ang - Math.PI/7), y1 - head*Math.sin(ang - Math.PI/7));
    ctx.lineTo(x1 - head*Math.cos(ang + Math.PI/7), y1 - head*Math.sin(ang + Math.PI/7));
    ctx.closePath();
    ctx.fill();

    ctx.font = '12px system-ui';
    ctx.fillText(label, x1 + 6, y1 + 4);
    ctx.restore();
  }

  function render() {
    tolTxt.textContent = `${Number(tol.value).toFixed(3)} N`;

    const N = Number(nPulleys.value);
    p3Block.style.display = (N === 3) ? 'block' : 'none';

    // sanitize angles
    const A1 = clampAngle(Number(a1.value) || 0);
    const A2 = clampAngle(Number(a2.value) || 0);
    const A3 = clampAngle(Number(a3.value) || 0);
    a1.value = A1; a2.value = A2; a3.value = A3;

    const f1 = forceFromMassAngle(Number(m1.value)||0, A1);
    const f2 = forceFromMassAngle(Number(m2.value)||0, A2);
    const f3 = (N===3) ? forceFromMassAngle(Number(m3.value)||0, A3) : {T:0,Fx:0,Fy:0};

    // equilibrium check (internal)
    const Rx = f1.Fx + f2.Fx + (N===3 ? f3.Fx : 0);
    const Ry = f1.Fy + f2.Fy + (N===3 ? f3.Fy : 0);
    const R = vecMag(Rx,Ry);

    const tolN = Math.max(0, Number(tol.value)||0);
    const isEq = R <= tolN;

    eqBadge.textContent = isEq ? `✅ Balanced` : `❌ Not balanced`;
    eqBadge.style.borderColor = isEq ? '#22c55e' : '#ef4444';

    // draw
    const W = cv.getBoundingClientRect().width;
    const H = cv.getBoundingClientRect().height;
    ctx.clearRect(0,0,W,H);

    const cx = W/2, cy = H/2;
    const radius = Math.min(W,H)*0.28;

    // grid
    ctx.save();
    ctx.globalAlpha = 0.25;
    ctx.strokeStyle = '#2a3a58';
    ctx.lineWidth = 1;
    for (let x=0; x<=W; x+=40){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke(); }
    for (let y=0; y<=H; y+=40){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }
    ctx.restore();

    // circle
    ctx.save();
    ctx.strokeStyle = '#3b82f6';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(cx,cy,radius,0,Math.PI*2);
    ctx.stroke();
    ctx.restore();

    // scale based ONLY on pulley tensions (no resultant arrow)
    const Ts = [f1.T, f2.T, f3.T];
    const maxT = Math.max(0.0001, ...Ts);
    const arrowScale = radius * 0.95 / maxT;

    // axes
    ctx.save();
    ctx.strokeStyle = '#94a3b8';
    ctx.fillStyle = '#94a3b8';
    ctx.lineWidth = 1.5;
    drawArrow(cx,cy, cx+radius, cy, '+x');
    drawArrow(cx,cy, cx, cy-radius, '+y');
    ctx.restore();

    function setColor(hex){
      ctx.strokeStyle = hex;
      ctx.fillStyle = hex;
    }

    setColor('#22c55e');
    drawArrow(cx,cy, cx + f1.Fx*arrowScale, cy - f1.Fy*arrowScale, 'F1');

    setColor('#f59e0b');
    drawArrow(cx,cy, cx + f2.Fx*arrowScale, cy - f2.Fy*arrowScale, 'F2');

    if (N===3) {
      setColor('#a78bfa');
      drawArrow(cx,cy, cx + f3.Fx*arrowScale, cy - f3.Fy*arrowScale, 'F3');
    }

    // angle markers
    function markAngle(Adeg, hex, label){
      const th = deg2rad(Adeg);
      const px = cx + radius*Math.cos(th);
      const py = cy - radius*Math.sin(th);
      ctx.save();
      ctx.fillStyle = hex;
      ctx.beginPath();
      ctx.arc(px,py,6,0,Math.PI*2);
      ctx.fill();
      ctx.font = '12px system-ui';
      ctx.fillText(label, px+8, py+4);
      ctx.restore();
    }
    markAngle(A1, '#22c55e', `θ1`);
    markAngle(A2, '#f59e0b', `θ2`);
    if (N===3) markAngle(A3, '#a78bfa', `θ3`);

    requestAnimationFrame(render);
  }

  function randAng() { return (Math.random()*360).toFixed(1); }

  // Attempts: increment on "change" (not every keystroke)
  const attemptOnChange = [nPulleys, a1, a2, a3, m1, m2, m3, tol];
  attemptOnChange.forEach(x => x.addEventListener('change', bumpAttempt));

  randomizeBtn.addEventListener('click', () => {
    a1.value = randAng();
    a2.value = randAng();
    a3.value = randAng();
    bumpAttempt();
  });

  resetBtn.addEventListener('click', () => {
    nPulleys.value = '2';
    a1.value = 0;  m1.value = 100;
    a2.value = 120; m2.value = 200;
    a3.value = 240; m3.value = 100;
    tol.value = 0.05;
    setAttempts(0);
  });

  setAttempts(0);
  render();
})();
</script>
</body>
</html>
